<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã“ã„ã‚“ã¨ã™ã’ãƒ¼ã‚€</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 10px; background-color: #f0f0f0; }
        .game-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 900px; margin: 0 auto; }
        .panel { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .stats-display { font-size: 16px; text-align: left; background: #fffde7; padding: 10px; border-radius: 10px; margin-bottom: 10px; line-height: 1.6; }
        .coin-btn { padding: 15px; font-size: 18px; cursor: pointer; background: #ffd700; border: none; border-radius: 10px; box-shadow: 0 4px #b8860b; width: 100%; transition: 0.1s; }
        .coin-btn:disabled { background: #ccc !important; box-shadow: none !important; transform: translateY(4px); cursor: not-allowed; }
        .shop-item { display: flex; justify-content: space-between; margin: 5px 0; font-size: 14px; align-items: center; }
        .buy-btn { padding: 8px 12px; background: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .buy-btn:disabled { background: #aaa; }
        .battle-panel { background: #ffebee; border: 2px solid #ef9a9a; position: relative; }
        .monster-hp-bar { width: 100%; height: 20px; background: #ddd; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .hp-fill { height: 100%; background: #ff5252; width: 100%; transition: 0.2s; }
        .log { height: 250px; overflow-y: auto; background: #333; color: #fff; font-size: 13px; padding: 8px; text-align: left; border-radius: 5px; margin-top: 10px; line-height: 1.4; }
        #battle-cooldown-text { color: #d32f2f; font-weight: bold; font-size: 14px; height: 1.2em; margin-top: 5px; }
        .crit-text { color: #ffeb3b; font-weight: bold; text-shadow: 0 0 5px red; }
        .system-menu { margin-top: 20px; padding: 10px; border-top: 1px solid #ccc; text-align: right; }
        .reset-btn { padding: 5px 10px; font-size: 11px; cursor: pointer; border-radius: 5px; background: #eee; border: 1px solid #999; color: #666; }
    </style>
</head>
<body>

<h1>ğŸ’° ã“ã„ã‚“ã¨ã™ã’ãƒ¼ã‚€</h1>

<div class="game-layout">
    <div class="panel">
        <div class="stats-display">
            <strong>ğŸ‘¤ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</strong><br>
            Lv: <span id="level">1</span> | EXP: <span id="exp">0</span> / 70<br>
            ğŸ’° æ‰€æŒé‡‘: <span id="money">0</span> å††<br>
            <hr>
            â¤ï¸ æœ€å¤§ä½“åŠ›: <span id="p-maxhp">100</span><br>
            âš”ï¸ ç­‹åŠ› (ATK): <span id="p-atk">10</span> | ğŸ›¡ï¸ è€ä¹… (DEF): <span id="p-def">5</span>
        </div>
        <button id="toss-button" class="coin-btn" onclick="tossCoin()">ã‚³ã‚¤ãƒ³ã‚’æŠ•ã’ã‚‹ï¼</button>
        <div id="cooldown-text" style="font-size: 12px; margin-top: 5px;">æº–å‚™å®Œäº†</div>
        <div id="message" style="font-weight: bold; height: 1.5em; margin: 10px 0;"></div>
        
        <h3>ğŸ›’ å¼·åŒ–ã‚·ãƒ§ãƒƒãƒ—</h3>
        <div class="shop-item"><span>â¤ï¸ ä½“åŠ› (+20)</span><button id="btn-buy-hp" class="buy-btn" onclick="buyStat('hp')"><span id="c-hp">100</span>å††</button></div>
        <div class="shop-item"><span>âš”ï¸ ç­‹åŠ› (+5)</span><button id="btn-buy-atk" class="buy-btn" onclick="buyStat('atk')"><span id="c-atk">150</span>å††</button></div>
        <div class="shop-item"><span>ğŸ›¡ï¸ è€ä¹… (+3)</span><button id="btn-buy-def" class="buy-btn" onclick="buyStat('def')"><span id="c-def">200</span>å††</button></div>

        <div class="system-menu">
            <button class="reset-btn" onclick="resetGame()">ğŸ§¹ ãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆå»ã—ã¦æœ€åˆã‹ã‚‰</button>
        </div>
    </div>

    <div class="panel battle-panel">
        <h3>ğŸ‘¾ ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã¨æˆ¦é—˜</h3>
        <div class="monster-hp-bar"><div id="m-hp-fill" class="hp-fill"></div></div>
        <div style="font-size: 14px;">æ•µHP: <span id="m-hp">50</span> / <span id="m-maxhp">50</span></div>
        <br>
        <button id="battle-btn" class="coin-btn" style="background:#f44336; box-shadow:0 4px #b71c1c;" onclick="startBattle()">ãƒãƒˆãƒ«é–‹å§‹ï¼</button>
        <div id="battle-cooldown-text"></div>
        <div id="log" class="log">ãƒ­ã‚°: æˆ¦é—˜ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</div>
    </div>
</div>

<script>
    const MAX_EXP = 70;
    let player = { money: 0, level: 1, exp: 0, hp: 100, maxHp: 100, atk: 10, def: 5 };
    let enemy = { hp: 50, maxHp: 50, atk: 8, expYield: 10 };
    let shopCosts = { hp: 100, atk: 150, def: 200 };
    let combo = 0, isCoolingDown = false, isBattling = false, isBattleCoolingDown = false;

    function saveGame() {
        const gameData = { player, enemy, shopCosts };
        localStorage.setItem('coinTossTycoonData', JSON.stringify(gameData));
    }

    function loadGame() {
        const savedData = localStorage.getItem('coinTossTycoonData');
        if (savedData) {
            const data = JSON.parse(savedData);
            player = data.player; enemy = data.enemy; shopCosts = data.shopCosts;
        }
        updateDisplay();
    }

    function resetGame() { if (confirm("æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™ã‹ï¼Ÿ")) { localStorage.clear(); location.reload(); } }

    function updateDisplay() {
        document.getElementById('money').innerText = player.money.toLocaleString();
        document.getElementById('level').innerText = player.level;
        document.getElementById('exp').innerText = player.exp;
        document.getElementById('p-maxhp').innerText = player.maxHp;
        document.getElementById('p-atk').innerText = player.atk;
        document.getElementById('p-def').innerText = player.def;
        
        document.getElementById('m-hp').innerText = Math.max(0, enemy.hp);
        document.getElementById('m-maxhp').innerText = enemy.maxHp;
        document.getElementById('m-hp-fill').style.width = (enemy.hp / enemy.maxHp * 100) + "%";
        
        document.getElementById('c-hp').innerText = shopCosts.hp;
        document.getElementById('c-atk').innerText = shopCosts.atk;
        document.getElementById('c-def').innerText = shopCosts.def;
        
        document.getElementById('btn-buy-hp').disabled = player.money < shopCosts.hp;
        document.getElementById('btn-buy-atk').disabled = player.money < shopCosts.atk;
        document.getElementById('btn-buy-def').disabled = player.money < shopCosts.def;
    }

    function tossCoin() {
        if (isCoolingDown) return;
        const msg = document.getElementById('message');
        if (Math.random() < 0.5) {
            combo++;
            let prize = 10 * player.level * Math.pow(2, combo - 1);
            player.money += prize;
            msg.innerText = `âœ¨ è¡¨ï¼ ${prize}å††ï¼`;
            msg.style.color = "orange";
        } else {
            combo = 0;
            msg.innerText = "ğŸ’€ è£...";
            msg.style.color = "blue";
        }
        startCooldown();
        updateDisplay();
        if(Math.random() < 0.1) saveGame();
    }

    function startCooldown() {
        isCoolingDown = true;
        let time = 2.0;
        const btn = document.getElementById('toss-button');
        btn.disabled = true;
        const timer = setInterval(() => {
            time -= 0.1;
            document.getElementById('cooldown-text').innerText = `æ¬¡ã¾ã§: ${time.toFixed(1)}s`;
            if (time <= 0) { clearInterval(timer); isCoolingDown = false; btn.disabled = false; document.getElementById('cooldown-text').innerText = "æº–å‚™å®Œäº†ï¼"; }
        }, 100);
    }

    function buyStat(type) {
        if (player.money >= shopCosts[type]) {
            player.money -= shopCosts[type];
            if (type === 'hp') { player.maxHp += 20; }
            if (type === 'atk') player.atk += 5;
            if (type === 'def') player.def += 3;
            shopCosts[type] = Math.floor(shopCosts[type] * 1.6);
            updateDisplay();
            saveGame();
        }
    }

    function addLog(text) {
        const log = document.getElementById('log');
        log.innerHTML += text + "<br>";
        log.scrollTop = log.scrollHeight;
    }

    function startBattle() {
        if (isBattling || isBattleCoolingDown) return;
        isBattling = true;
        player.hp = player.maxHp;
        document.getElementById('battle-btn').disabled = true;
        addLog("--- æˆ¦é—˜é–‹å§‹ ---");

        const battleInterval = setInterval(() => {
            let isCrit = Math.random() < 0.15;
            let pDamage = isCrit ? player.atk * 2 : player.atk;
            enemy.hp -= pDamage;
            if (isCrit) { addLog(`<span class="crit-text">ğŸ’¥ Critical!! ${pDamage}ãƒ€ãƒ¡ï¼</span>`); }
            else { addLog(`âš”ï¸ æ”»æ’ƒï¼š${pDamage}ãƒ€ãƒ¡`); }

            if (enemy.hp <= 0) { clearInterval(battleInterval); winBattle(); return; }

            let eDamage = Math.max(1, enemy.atk - player.def);
            player.hp -= eDamage;
            addLog(`ğŸ’¢ è¢«å¼¾ï¼š${eDamage}ï¼ (æ®‹:${Math.max(0, player.hp)})`);
            
            if (player.hp <= 0) { clearInterval(battleInterval); addLog("ğŸ’€ æ•—åŒ—..."); endBattle(); }
            updateDisplay();
        }, 800);
    }

    function winBattle() {
        let expGain = Math.min(20, 5 + Math.floor(enemy.maxHp / 50));
        addLog(`ğŸ‰ å‹åˆ©ï¼ ${expGain} EXPç²å¾—ï¼`);
        player.exp += expGain;
        
        while (player.exp >= MAX_EXP) { 
            player.level++; 
            player.exp -= MAX_EXP; 
            addLog("ğŸŠ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼"); 
        }
        
        enemy.maxHp = Math.floor(enemy.maxHp * 1.25);
        enemy.atk += 2;
        endBattle();
        saveGame();
    }

    function endBattle() {
        enemy.hp = enemy.maxHp;
        isBattling = false;
        startBattleCooldown();
        updateDisplay();
    }

    function startBattleCooldown() {
        isBattleCoolingDown = true;
        let time = 3.0;
        const btn = document.getElementById('battle-btn');
        const text = document.getElementById('battle-cooldown-text');
        const timer = setInterval(() => {
            time -= 0.1;
            text.innerText = `ç´¢æ•µä¸­... ${time.toFixed(1)}s`;
            if (time <= 0) { clearInterval(timer); isBattleCoolingDown = false; btn.disabled = false; text.innerText = ""; }
        }, 100);
    }

    loadGame();
    setInterval(saveGame, 10000);
</script>
</body>
</html>
